secrets:
  - kmsKeyName: projects/text-sentiment-247119/locations/global/keyRings/storage/cryptoKeys/mykey
    secretEnv:
      MY_SECRET: compute-engine-key.json.encrypted
steps:
  - name: node:10.15.1
    entrypoint: npm
    args: ["install"]
  - name: node:10.15.1
    entrypoint: npm
    args: ["run", "build"]
  - name: "gcr.io/cloud-builders/gcloud"
    args:
      - kms
      - decrypt
      - --ciphertext-file=compute-engine-key.json.encrypted
        - --plaintext-file=compute-engine-key.json
        - --location=global
        - --keyring=storage
        - --key=mykey
      - app
      - deploy
    secretEnv:
      - 'MY_SECRET'

timeout: "1600s"